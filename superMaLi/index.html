<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>冒险岛小程序</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .game-container {
            position: relative;
            width: 800px;
            height: 600px;
            background-color: #87CEEB;
            border: 2px solid #333;
            overflow: hidden;
        }

        .game-header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
        }

        .player-info {
            display: flex;
            gap: 20px;
        }

        .game-map {
            position: absolute;
            top: 50px;
            left: 0;
            width: 100%;
            height: calc(100% - 50px);
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 50%, #F0E68C 100%);
        }

        .player {
            position: absolute;
            width: 40px;
            height: 40px;
            background-color: #FF6B6B;
            border-radius: 50%;
            transition: all 0.1s ease;
            z-index: 10;
        }

        .monster {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #4ECDC4;
            border-radius: 50%;
            transition: all 0.1s ease;
        }

        .bullet {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: #FFD166;
            border-radius: 50%;
            z-index: 5;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            font-size: 24px;
            z-index: 200;
            display: none;
        }

        .game-over button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4ECDC4;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
        }

        .game-over button:hover {
            background-color: #45B7AA;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: grid;
            grid-template-areas: 
                ". up ."
                "left . right"
                ". down .";
            gap: 10px;
            z-index: 100;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .control-btn:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        .up {
            grid-area: up;
        }

        .left {
            grid-area: left;
        }

        .right {
            grid-area: right;
        }

        .down {
            grid-area: down;
        }

        .attack-btn {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 80px;
            height: 80px;
            background-color: rgba(255, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            z-index: 100;
        }

        .attack-btn:hover {
            background-color: rgba(255, 0, 0, 0.9);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <div class="player-info">
                <div>生命值: <span id="health">100</span></div>
                <div>等级: <span id="level">1</span></div>
                <div>经验值: <span id="exp">0</span>/<span id="exp-required">100</span></div>
            </div>
            <div>分数: <span id="score">0</span></div>
        </div>
        
        <div class="game-map" id="gameMap">
            <div class="player" id="player"></div>
        </div>
        
        <div class="game-over" id="gameOver">
            <div>游戏结束</div>
            <div>最终分数: <span id="finalScore">0</span></div>
            <button onclick="restartGame()">重新开始</button>
        </div>
        
        <div class="controls">
            <button class="control-btn up" onclick="movePlayer('up')">↑</button>
            <button class="control-btn left" onclick="movePlayer('left')">←</button>
            <button class="control-btn right" onclick="movePlayer('right')">→</button>
            <button class="control-btn down" onclick="movePlayer('down')">↓</button>
        </div>
        
        <button class="attack-btn" onclick="attack()">攻击</button>
    </div>

    <script>
        // 游戏状态
        let gameState = {
            player: {
                x: 400,
                y: 300,
                health: 100,
                level: 1,
                exp: 0,
                expRequired: 100,
                speed: 5,
                direction: 'right'
            },
            monsters: [],
            bullets: [],
            score: 0,
            gameRunning: true,
            monsterSpawnRate: 1000, // 毫秒
            lastMonsterSpawn: 0
        };

        // DOM元素
        const playerElement = document.getElementById('player');
        const gameMap = document.getElementById('gameMap');
        const healthElement = document.getElementById('health');
        const levelElement = document.getElementById('level');
        const expElement = document.getElementById('exp');
        const expRequiredElement = document.getElementById('exp-required');
        const scoreElement = document.getElementById('score');
        const gameOverElement = document.getElementById('gameOver');
        const finalScoreElement = document.getElementById('finalScore');

        // 初始化游戏
        function initGame() {
            updatePlayerPosition();
            gameLoop();
        }

        // 游戏主循环
        function gameLoop() {
            if (!gameState.gameRunning) return;

            const now = Date.now();
            
            // 生成怪物
            if (now - gameState.lastMonsterSpawn > gameState.monsterSpawnRate) {
                spawnMonster();
                gameState.lastMonsterSpawn = now;
            }

            // 更新怪物位置
            updateMonsters();
            
            // 更新子弹位置
            updateBullets();
            
            // 碰撞检测
            checkCollisions();
            
            // 更新UI
            updateUI();
            
            requestAnimationFrame(gameLoop);
        }

        // 生成怪物
        function spawnMonster() {
            const side = Math.floor(Math.random() * 4);
            let x, y;
            
            switch(side) {
                case 0: // 上
                    x = Math.random() * (gameMap.offsetWidth - 30);
                    y = -30;
                    break;
                case 1: // 右
                    x = gameMap.offsetWidth;
                    y = Math.random() * (gameMap.offsetHeight - 30);
                    break;
                case 2: // 下
                    x = Math.random() * (gameMap.offsetWidth - 30);
                    y = gameMap.offsetHeight;
                    break;
                case 3: // 左
                    x = -30;
                    y = Math.random() * (gameMap.offsetHeight - 30);
                    break;
            }
            
            const monster = {
                id: Date.now() + Math.random(),
                x: x,
                y: y,
                speed: 2,
                health: 20
            };
            
            gameState.monsters.push(monster);
            
            const monsterElement = document.createElement('div');
            monsterElement.className = 'monster';
            monsterElement.id = `monster-${monster.id}`;
            monsterElement.style.left = `${monster.x}px`;
            monsterElement.style.top = `${monster.y}px`;
            gameMap.appendChild(monsterElement);
        }

        // 更新怪物位置
        function updateMonsters() {
            gameState.monsters.forEach(monster => {
                // 怪物向玩家移动
                const dx = gameState.player.x - monster.x;
                const dy = gameState.player.y - monster.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                monster.x += (dx / distance) * monster.speed;
                monster.y += (dy / distance) * monster.speed;
                
                // 更新DOM
                const monsterElement = document.getElementById(`monster-${monster.id}`);
                if (monsterElement) {
                    monsterElement.style.left = `${monster.x}px`;
                    monsterElement.style.top = `${monster.y}px`;
                }
            });
        }

        // 移动玩家
        function movePlayer(direction) {
            if (!gameState.gameRunning) return;
            
            let newX = gameState.player.x;
            let newY = gameState.player.y;
            
            switch(direction) {
                case 'up':
                    newY -= gameState.player.speed;
                    break;
                case 'down':
                    newY += gameState.player.speed;
                    break;
                case 'left':
                    newX -= gameState.player.speed;
                    gameState.player.direction = 'left';
                    break;
                case 'right':
                    newX += gameState.player.speed;
                    gameState.player.direction = 'right';
                    break;
            }
            
            // 边界检测
            newX = Math.max(0, Math.min(gameMap.offsetWidth - 40, newX));
            newY = Math.max(0, Math.min(gameMap.offsetHeight - 40, newY));
            
            gameState.player.x = newX;
            gameState.player.y = newY;
            
            updatePlayerPosition();
        }

        // 更新玩家位置
        function updatePlayerPosition() {
            playerElement.style.left = `${gameState.player.x}px`;
            playerElement.style.top = `${gameState.player.y}px`;
            playerElement.style.transform = gameState.player.direction === 'left' ? 'scaleX(-1)' : 'scaleX(1)';
        }

        // 攻击
        function attack() {
            if (!gameState.gameRunning) return;
            
            const bullet = {
                id: Date.now() + Math.random(),
                x: gameState.player.x + 20,
                y: gameState.player.y + 20,
                speed: 10,
                direction: gameState.player.direction
            };
            
            gameState.bullets.push(bullet);
            
            const bulletElement = document.createElement('div');
            bulletElement.className = 'bullet';
            bulletElement.id = `bullet-${bullet.id}`;
            bulletElement.style.left = `${bullet.x}px`;
            bulletElement.style.top = `${bullet.y}px`;
            gameMap.appendChild(bulletElement);
        }

        // 更新子弹位置
        function updateBullets() {
            gameState.bullets.forEach(bullet => {
                switch(bullet.direction) {
                    case 'left':
                        bullet.x -= bullet.speed;
                        break;
                    case 'right':
                        bullet.x += bullet.speed;
                        break;
                }
                
                // 更新DOM
                const bulletElement = document.getElementById(`bullet-${bullet.id}`);
                if (bulletElement) {
                    bulletElement.style.left = `${bullet.x}px`;
                    bulletElement.style.top = `${bullet.y}px`;
                }
            });
            
            // 移除超出边界的子弹
            gameState.bullets = gameState.bullets.filter(bullet => {
                const isOutOfBounds = bullet.x < 0 || bullet.x > gameMap.offsetWidth || 
                                      bullet.y < 0 || bullet.y > gameMap.offsetHeight;
                
                if (isOutOfBounds) {
                    const bulletElement = document.getElementById(`bullet-${bullet.id}`);
                    if (bulletElement) {
                        bulletElement.remove();
                    }
                }
                
                return !isOutOfBounds;
            });
        }

        // 碰撞检测
        function checkCollisions() {
            // 子弹与怪物碰撞
            gameState.bullets.forEach((bullet, bulletIndex) => {
                gameState.monsters.forEach((monster, monsterIndex) => {
                    const dx = bullet.x - (monster.x + 15);
                    const dy = bullet.y - (monster.y + 15);
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 20) {
                        // 子弹击中怪物
                        monster.health -= 10;
                        
                        // 移除子弹
                        const bulletElement = document.getElementById(`bullet-${bullet.id}`);
                        if (bulletElement) {
                            bulletElement.remove();
                        }
                        gameState.bullets.splice(bulletIndex, 1);
                        
                        // 检查怪物是否死亡
                        if (monster.health <= 0) {
                            // 移除怪物
                            const monsterElement = document.getElementById(`monster-${monster.id}`);
                            if (monsterElement) {
                                monsterElement.remove();
                            }
                            gameState.monsters.splice(monsterIndex, 1);
                            
                            // 增加分数和经验
                            gameState.score += 10;
                            gameState.player.exp += 5;
                            
                            // 检查升级
                            if (gameState.player.exp >= gameState.player.expRequired) {
                                levelUp();
                            }
                        }
                    }
                });
            });
            
            // 怪物与玩家碰撞
            gameState.monsters.forEach((monster, monsterIndex) => {
                const dx = gameState.player.x - monster.x;
                const dy = gameState.player.y - monster.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 50) {
                    // 玩家受到伤害
                    gameState.player.health -= 1;
                    
                    // 移除怪物
                    const monsterElement = document.getElementById(`monster-${monster.id}`);
                    if (monsterElement) {
                        monsterElement.remove();
                    }
                    gameState.monsters.splice(monsterIndex, 1);
                    
                    // 检查游戏结束
                    if (gameState.player.health <= 0) {
                        gameOver();
                    }
                }
            });
        }

        // 升级
        function levelUp() {
            gameState.player.level++;
            gameState.player.exp -= gameState.player.expRequired;
            gameState.player.expRequired = Math.floor(gameState.player.expRequired * 1.5);
            gameState.player.health = 100;
            gameState.player.speed += 1;
        }

        // 更新UI
        function updateUI() {
            healthElement.textContent = gameState.player.health;
            levelElement.textContent = gameState.player.level;
            expElement.textContent = gameState.player.exp;
            expRequiredElement.textContent = gameState.player.expRequired;
            scoreElement.textContent = gameState.score;
        }

        // 游戏结束
        function gameOver() {
            gameState.gameRunning = false;
            finalScoreElement.textContent = gameState.score;
            gameOverElement.style.display = 'block';
        }

        // 重新开始游戏
        function restartGame() {
            // 重置游戏状态
            gameState = {
                player: {
                    x: 400,
                    y: 300,
                    health: 100,
                    level: 1,
                    exp: 0,
                    expRequired: 100,
                    speed: 5,
                    direction: 'right'
                },
                monsters: [],
                bullets: [],
                score: 0,
                gameRunning: true,
                monsterSpawnRate: 1000,
                lastMonsterSpawn: 0
            };
            
            // 移除所有怪物和子弹
            document.querySelectorAll('.monster, .bullet').forEach(element => {
                element.remove();
            });
            
            // 更新UI
            updateUI();
            updatePlayerPosition();
            
            // 隐藏游戏结束界面
            gameOverElement.style.display = 'none';
            
            // 重新开始游戏循环
            gameLoop();
        }

        // 键盘控制
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp':
                    movePlayer('up');
                    break;
                case 'ArrowDown':
                    movePlayer('down');
                    break;
                case 'ArrowLeft':
                    movePlayer('left');
                    break;
                case 'ArrowRight':
                    movePlayer('right');
                    break;
                case ' ':
                    e.preventDefault();
                    attack();
                    break;
            }
        });

        // 初始化游戏
        initGame();
    </script>
</body>
</html>